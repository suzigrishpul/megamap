function swallowError(s){gutil.log("ERROR"),gutil.log(s.toString()),this.emit("end")}var gulp=require("gulp"),gutil=require("gulp-util"),jshint=require("gulp-jshint"),sass=require("gulp-sass"),sourcemaps=require("gulp-sourcemaps"),gulpPlugins=require("gulp-load-plugins"),babel=require("gulp-babel"),plumber=require("gulp-plumber"),concat=require("gulp-concat"),webserver=require("gulp-webserver"),inject=require("gulp-inject"),hash=require("gulp-hash"),uglify=require("gulp-uglify"),order=require("gulp-order"),s3=require("gulp-s3"),cloudfront=require("gulp-cloudfront");gulp.task("default",["build-css","build-js","inject","webserver","watch","prepare-export"]),gulp.task("jshint",function(){return gulp.src("source/javascript/**/*.js").pipe(jshint({esversion:6})).pipe(jshint.reporter("jshint-stylish"))}),gulp.task("build-js",function(){return gulp.src(["source/javascript/**/*.js"]).pipe(plumber()).pipe(sourcemaps.init()).pipe(order(["source/javascript/classes/*.js","source/javascript/app.js"],{base:"./"})).pipe(babel({presets:["es2015"]})).pipe(concat("bundle.js")).pipe("production"===gutil.env.type?uglify():gutil.noop()).pipe(sourcemaps.write()).pipe(gulp.dest("public/assets/javascript"))}),gulp.task("build-css",function(){var s=sass();return gulp.src("source/scss/**/*.scss").pipe(plumber()).pipe(sass()).pipe(sourcemaps.write()).pipe(gulp.dest("public/assets/stylesheets"))}),gulp.task("webserver",function(){gulp.src(["app","public/assets"]).pipe(webserver({}))}),gulp.task("inject",function(){var s={algorithm:"sha1",hashLength:30+40*Math.random(),template:"<%= name %><%= ext %>?hash=<%= hash %>"},e=gulp.src("source/html/index.html"),p=gulp.src(["public/assets/javascript/**/*.js","public/assets/stylesheets/**/*.css","public/assets/javascript/*.js","public/assets/stylesheets/*.css"],{read:!1}).pipe(order(["public/assets/javascript/vendor/jquery.min.js","public/assets/javascript/vendor/leaflet.min.js","public/assets/javascript/vendor/terminator.js","public/assets/javascript/vendor/bootstrap.bundle.min.js","public/assets/javascript/vendor/bootstrap-multiselect.js","public/assets/javascript/vendor/*.min.js","public/assets/javascript/**/*.js","public/assets/stylesheets/vendor/**/*.css","public/assets/javascript/*.js","public/assets/stylesheets/*.css"],{base:"./"})).pipe(hash(s));return e.pipe(inject(p,{ignorePath:"public/assets"})).pipe(gulp.dest("app"))}),gulp.task("watch",function(){gulp.watch("source/javascript/**/*.js",["build-js","jshint"]),gulp.watch("source/scss/**/*.scss",["build-css"]),gulp.watch("source/**",["inject","prepare-export"])}),gulp.task("publish",["build-css","build-js","inject","prepare-export","export"]),gulp.task("prepare-export",function(){gulp.src("app/index.html").pipe(gulp.dest("dist")),gulp.src(["public/assets/javascript/**/*.js","public/assets/javascript/*.js"]).pipe(gulp.dest("dist/javascript")),gulp.src(["public/assets/stylesheets/**/*"]).pipe(gulp.dest("dist/stylesheets")),gulp.src(["public/assets/stylesheets/**/*"]).pipe(gulp.dest("dist/stylesheets")),gulp.src(["public/assets/data/**/*"]).pipe(gulp.dest("dist/data")),gulp.src(["public/assets/img/**/*","public/assets/img/*"]).pipe(gulp.dest("dist/img"))}),gulp.task("export",function(){var s={key:process.env.AWS_ACCESS_KEY,secret:process.env.AWS_SECRET_KEY,bucket:process.env.AWS_BUCKET_NAME,region:process.env.AWS_REGION,distributionId:process.env.CLOUDFRONT_ID};gulp.src("./dist/**").pipe(s3(s)).pipe(cloudfront(s))});